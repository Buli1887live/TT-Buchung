<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Buchungsformular – Technik‑Team</title>
  <style>
    :root { --max: 900px; }
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; line-height: 1.45; margin: 0; background:#f7f7f8; color:#0f172a; }
    header { background:#0b63ce; color:#fff; padding: 1.2rem 1rem; }
    header h1 { margin: 0; font-size: 1.25rem; }
    main { max-width: var(--max); margin: 1rem auto; background:#fff; padding: 1rem; border-radius: 12px; box-shadow: 0 4px 18px rgba(0,0,0,.05); }
    form { display: grid; gap: .9rem; }
    .row { display: grid; gap: .6rem; }
    @media (min-width: 720px){ .grid-2 { grid-template-columns: 1fr 1fr; gap: 1rem; } }
    label { font-weight: 600; }
    input[type="text"], input[type="email"], input[type="date"], input[type="time"], textarea, select { width: 100%; padding: .65rem .7rem; border: 1px solid #cdd2d7; border-radius: 8px; font: inherit; background:#fff; }
    textarea { min-height: 120px; resize: vertical; }
    .muted { color:#667085; font-size: .92rem; }
    .inline { display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; }
    .actions { display:flex; gap:.6rem; align-items:center; }
    button { appearance: none; border: 0; padding: .75rem 1rem; border-radius: 10px; cursor: pointer; font-weight:600; }
    button[type="submit"] { background:#0b63ce; color:#fff; }
    button[type="reset"] { background:#eef2f6; }
    .alert { padding:.8rem 1rem; border-radius:10px; display:none; }
    .alert.ok { background:#e7f5ea; color:#0a6b2d; }
    .alert.err{ background:#fdeaea; color:#9d0b0b; }
    .req::after { content:" *"; color:#d10; }
    .sr-only{ position:absolute; left:-9999px; }
      /* --- Fixes: bessere Zeitfeld-Ausrichtung & Touch-Ziele --- */
    label{ display:block; margin-bottom:.25rem; font-weight:600; }
    .inline{ display:flex; gap:1rem; align-items:flex-end; flex-wrap:wrap; }
    .inline > div{ flex:1 1 200px; min-width:160px; }
    input[type="date"], input[type="time"]{ height:44px; }
    @media (max-width:520px){ .inline > div{ min-width:100%; } }
  </style>
</head>
<body>
  <header>
    <h1>Buchungsformular – Technik‑Team</h1>
  </header>
  <main>
    <form id="bookingForm" novalidate>
      <!-- Tag/Zeitraum -->
      <div class="row grid-2">
        <div>
          <label for="date" class="req">Tag der Veranstaltung</label>
          <input id="date" name="date" type="date" required />
        </div>
        <div class="inline">
          <div>
            <label for="time_from" class="req">von</label>
            <input id="time_from" name="time_from" type="time" required />
          </div>
          <div>
            <label for="time_to" class="req">bis</label>
            <input id="time_to" name="time_to" type="time" required />
          </div>
        </div>
      </div>

      <!-- Name/Ort -->
      <div class="row grid-2">
        <div>
          <label for="event_name" class="req">Name der Veranstaltung</label>
          <input id="event_name" name="event_name" type="text" placeholder="z. B. Theateraufführung 9b" required />
        </div>
        <div>
          <label for="location" class="req">Veranstaltungsort</label>
          <input id="location" name="location" type="text" placeholder="z. B. Aula" required />
        </div>
      </div>

      <!-- Beschreibung -->
      <div class="row">
        <label for="description" class="req">Beschreibung der Veranstaltung</label>
        <textarea id="description" name="description" required placeholder="Kurz beschreiben (Ablauf, benötigte Unterstützung, Besonderheiten)"></textarea>
      </div>

      <!-- Personal benötigt -->
      <div class="row">
        <label class="req">Personal benötigt?</label>
        <div class="inline">
          <label><input type="radio" name="staff_needed" value="ja" required /> ja</label>
          <label><input type="radio" name="staff_needed" value="nein" /> nein</label>
        </div>
      </div>

      <!-- Benötigte Technik -->
      <div class="row">
        <label for="equipment">Benötigte Technik</label>
        <textarea id="equipment" name="equipment" placeholder="z. B. 2x Mikrofon, Beamer, Lichtpult"></textarea>
      </div>

      <!-- Zusatzinfos -->
      <div class="row">
        <label for="extra">Zusätzliche Informationen</label>
        <textarea id="extra" name="extra" placeholder="Zugang Schlüsselkasten, Aufbauzeiten, Ansprechpartner vor Ort …"></textarea>
      </div>

      <!-- Kontakt -->
      <div class="row">
        <label for="contact" class="req">Kontakt (E‑Mail)</label>
        <input id="contact" name="contact" type="email" placeholder="name@schule.de" required />
        <small class="muted">Wir verwenden diese E‑Mail nur zur Rückmeldung zur Buchung.</small>
      </div>

      <!-- Honeypot gegen Spam -->
      <div class="sr-only" aria-hidden="true">
        <label for="website">Website</label>
        <input id="website" name="website" type="text" tabindex="-1" autocomplete="off" />
      </div>

      <div class="actions">
        <button type="submit">Absenden</button>
        <button type="reset">Zurücksetzen</button>
      </div>

      <div id="ok" class="alert ok">Danke! Deine Buchung wurde übermittelt.</div>
      <div id="err" class="alert err">Fehler bei der Übertragung. Bitte später erneut versuchen.</div>

      <p class="muted">Hinweis: Bitte mindestens zwei Wochen vor Veranstaltungsbeginn einreichen.</p>
    </form>
  </main>

  <script>
    // Web‑App URL aus Google Apps Script eintragen
    const ENDPOINT = "https://script.google.com/macros/s/AKfycbyEmONYSM9-KMUMyFz_8YOBpVKB0y_PFNrYJhiOsOmy-PLqiw6uV1ESUWzp2FqCdUu-/exec"; // z. B. https://script.google.com/macros/s/…/exec

    function validateTimes(from, to){
      if(!from || !to) return true;
      return from < to; // einfache Plausibilitätsprüfung
    }

    const SUBMIT_DELAY_SECONDS = 3;

    function wait(ms) {
      return new Promise((resolve) => setTimeout(resolve, ms));
    }

    async function withSubmitDelay(button, seconds, task) {
      if (!button) return task();
      const originalLabel = button.textContent;
      button.disabled = true;
      button.dataset.cooldown = 'true';
      try {
        for (let remaining = seconds; remaining > 0; remaining--) {
          button.textContent = `${originalLabel} (${remaining})`;
          await wait(1000);
        }
        button.textContent = 'Wird gesendet…';
        return await task();
      } finally {
        delete button.dataset.cooldown;
        button.disabled = false;
        button.textContent = originalLabel;
      }
    }

    document.getElementById('bookingForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const f = e.currentTarget;
      const fd = new FormData(f);
      const submitButton = f.querySelector('button[type="submit"]');

      // Honeypot
      if (fd.get('website')) return;

      if (!validateTimes(fd.get('time_from'), fd.get('time_to'))){
        alert('Zeitspanne prüfen: "von" muss vor "bis" liegen.');
        return;
      }

      try {
        await withSubmitDelay(submitButton, SUBMIT_DELAY_SECONDS, async () => {
          const res = await fetch(ENDPOINT, { method: 'POST', body: fd, mode: 'cors' });
          if (!res.ok) throw new Error('HTTP '+res.status);
          document.getElementById('ok').style.display = 'block';
          document.getElementById('err').style.display = 'none';
          f.reset();
        });
      } catch (err) {
        document.getElementById('ok').style.display = 'none';
        document.getElementById('err').style.display = 'block';
      }
    });
  </script>
</body>
</html>

