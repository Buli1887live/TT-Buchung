<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Buchungsformular – Technik-Team</title>
  <style>
    :root { --maxw: 900px; }
    *, *::before, *::after { box-sizing: border-box; }
    html, body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, sans-serif; }
    body { margin: 0; background:#f6f7f9; }
    .wrap { max-width: var(--maxw); margin: 24px auto; background: #fff; padding: 24px; border-radius: 14px; box-shadow: 0 8px 24px rgba(0,0,0,.06); }
    h1 { margin: 0 0 8px; font-size: 1.6rem; }
    p.hint { margin: 0 0 16px; color:#444; }

    form { display: grid; gap: 14px; }
    .grid { display: grid; gap: 12px; }
    .grid > div { min-width: 0; }

    @media (min-width: 720px) {
      .g2 { grid-template-columns: repeat(2, minmax(0,1fr)); }
      .g3 { grid-template-columns: repeat(3, minmax(0,1fr)); }
    }

    label { font-weight: 600; display:block; margin-bottom: 6px; }
    input[type="text"], input[type="date"], input[type="time"], input[type="email"], textarea {
      width: 100%; max-width: 100%; display:block;
      padding: 10px 12px; border: 1px solid #d0d5dd; border-radius: 10px; font-size: 1rem; background: #fff;
    }
    textarea { min-height: 120px; resize: vertical; }
    .radio-row { display: flex; gap: 16px; align-items: center; flex-wrap: wrap; }
    .radio-row label { font-weight: 500; margin: 0 4px 0 0; }
    .note { font-size: .95rem; color:#555; }
    .actions { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    button { appearance: none; border: 0; background: #1f6feb; color: #fff; padding: 12px 16px; border-radius: 12px; font-weight: 700; cursor: pointer; }
    button.secondary { background: #eaeef4; color: #111; font-weight: 600; }
    .msg { padding: 12px 14px; border-radius: 10px; display:none; }
    .msg.ok { background: #e8f5e9; color: #1b5e20; }
    .msg.err { background: #fdecea; color: #b71c1c; }
    .req { color:#b71c1c; margin-left: 4px; }
    .footer { margin-top: 8px; font-size: .9rem; color:#666; }

    .title {
  display: flex;
  align-items: center;
  justify-content: center; /* zentriert horizontal */
  gap: 12px; /* Abstand zwischen Logo und Text */
  margin-bottom: 8px;
    }

    .title .logo {
    height: 48px;  /* Logo-Höhe anpassen */
  width: auto;
}

  </style>
</head>
<body>
  <div class="wrap">
     <div class="title">
        <img src="LGN.svg" alt="Technik-Team Logo" class="logo" />
        <h1>Buchungsformular – Technik-Team</h1>
     </div>

    <p class="hint">Buchung von technischem Equipment und/oder des Technik-Teams. Bitte mindestens <strong>zwei Wochen</strong> vor Veranstaltungsbeginn einreichen.</p>

    <form id="bookingForm" novalidate>
      <div class="grid g3">
        <div>
          <label for="eventDate">Tag der Veranstaltung<span class="req">*</span></label>
          <input type="date" id="eventDate" name="eventDate" required />
        </div>
        <div>
          <label for="timeFrom">von<span class="req">*</span></label>
          <input type="time" id="timeFrom" name="timeFrom" required />
        </div>
        <div>
          <label for="timeTo">bis<span class="req">*</span></label>
          <input type="time" id="timeTo" name="timeTo" required />
        </div>
      </div>

      <div class="grid g2">
        <div>
          <label for="eventName">Name der Veranstaltung<span class="req">*</span></label>
          <input type="text" id="eventName" name="eventName" required />
        </div>
        <div>
          <label for="location">Veranstaltungsort<span class="req">*</span></label>
          <input type="text" id="location" name="location" required />
        </div>
      </div>

      <div class="grid g2">
        <div>
          <label for="senderName">Verantwortliche Person / Absender<span class="req">*</span></label>
          <input type="text" id="senderName" name="senderName" placeholder="Vor- und Nachname" required />
        </div>
        <div>
          <label for="senderEmail">E-Mail<span class="req">*</span></label>
          <input type="email" id="senderEmail" name="senderEmail" placeholder="vor.nachname@schule-sh.de" required />
        </div>
      </div>

      <div>
        <label for="description">Beschreibung der Veranstaltung</label>
        <textarea id="description" name="description" placeholder="Kurze Beschreibung…"></textarea>
      </div>

      <div>
        <label>Personal benötigt?</label>
        <div class="radio-row">
          <input type="radio" id="staffYes" name="staffRequired" value="ja" />
          <label for="staffYes">ja</label>
          <input type="radio" id="staffNo" name="staffRequired" value="nein" checked />
          <label for="staffNo">nein</label>
        </div>
      </div>

      <div>
        <label for="tech">Benötigte Technik</label>
        <textarea id="tech" name="tech" placeholder="z. B. Mikrofone, Lautsprecher, Beamer, Mischpult…"></textarea>
      </div>

      <div>
        <label for="extra">Zusätzliche Informationen</label>
        <textarea id="extra" name="extra" placeholder="z. B. Aufbauzeiten, besondere Wünsche…"></textarea>
      </div>

      <div class="note">Mit dem Absenden werden die Angaben in Google Sheets gespeichert und an das Technik-Team übermittelt.</div>

      <div class="actions">
        <button type="submit">Absenden</button>
        <button type="reset" class="secondary">Zurücksetzen</button>
      </div>

      <div id="msgOk" class="msg ok" role="status">Danke! Die Buchung wurde übermittelt.</div>
      <div id="msgErr" class="msg err" role="alert">Fehler beim Absenden. Bitte Eingaben prüfen oder später erneut versuchen.</div>

      <div class="footer">Kontakt: <a href="mailto:technikteam@lg-n.de">technikteam@lg-n.de</a></div>
    </form>
  </div>

 <script>
  // ← HIER deine Apps-Script /exec URL eintragen
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzpoaWkXNPDs-HWQiaf0oLF-qwRE7zae1_lfPVX8bn8AxUP37hjBsb1AmU_HGez49aU/exec";

  const form  = document.getElementById('bookingForm');
  const msgOk = document.getElementById('msgOk');
  const msgErr = document.getElementById('msgErr');

  // Mindestdatum = heute + 14 Tage
  const eventDateEl = document.getElementById('eventDate');
  function setMinDate() {
    const d = new Date();
    d.setDate(d.getDate() + 14);
    eventDateEl.min = d.toISOString().slice(0,10);
  }
  setMinDate();

  function showMsg(type) {
    msgOk.style.display = 'none';
    msgErr.style.display = 'none';
    if (type === 'ok')  msgOk.style.display = 'block';
    if (type === 'err') msgErr.style.display = 'block';
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    showMsg();

    // einfache Zeit-Logik vorab
    const timeFrom = document.getElementById('timeFrom').value;
    const timeTo   = document.getElementById('timeTo').value;
    if (timeFrom && timeTo && timeFrom >= timeTo) {
      alert('Die Endzeit muss nach der Startzeit liegen.');
      return;
    }

    if (!SCRIPT_URL || !SCRIPT_URL.includes('/exec')) {
      alert('SCRIPT_URL fehlt oder ist keine /exec-URL.');
      return;
    }

    // Form-Daten als JSON
    const payload = Object.fromEntries(new FormData(form).entries());

    try {
      const res = await fetch(SCRIPT_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const json = await res.json();
      if (json.ok) { /* Erfolg */ } else { /* Fehler anzeigen */ }

      // Robust: prüfe Content-Type, sonst zeige sinnvolle Ursache
      let ok = false;
      let backendError = '';
      const ct = (res.headers && res.headers.get('content-type')) || '';

      if (ct.includes('application/json')) {
        const json = await res.json();
        ok = !!json && json.ok !== false;
        backendError = (json && json.error) ? String(json.error) : '';
      } else {
        // typisch: falsche Rechte, falsche URL (/dev), Login-HTML etc.
        backendError = 'Keine JSON-Antwort vom Backend. Prüfe Web-App Deploy (Anyone with the link) und /exec-URL. HTTP ' + res.status;
      }

      if (ok) {
        form.reset();
        setMinDate();
        showMsg('ok');
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } else {
        console.error('Backend error:', backendError);
        showMsg('err');
        alert(backendError); // zum Debuggen; danach auskommentieren
      }
    } catch (err) {
      console.error('Fetch/Netzwerkfehler:', err);
      showMsg('err');
      alert('Netzwerkfehler: ' + err.message);
    }
  });
</script>

</body>
</html>
